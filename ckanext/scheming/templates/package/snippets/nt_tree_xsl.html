<div class="filters">
    <div>
        <section class="module module-narrow module-shallow">
            <h2 class="module-heading">
                <i class="fa fa-filter"></i>
                Nested Tags
            </h2>
            <nav aria-label="nested_Tags" id="level">

                <div id="example" />

            </nav>
        </section>
    </div>
</div>

<script>
    function loadXMLDoc(filename) {
        if (window.ActiveXObject) {
            xhttp = new ActiveXObject("Msxml2.XMLHTTP");
        }
        else {
            xhttp = new XMLHttpRequest();
        }
        xhttp.open("GET", filename, false);
        try { xhttp.responseType = "msxml-document" } catch (err) { } // Helping IE11
        xhttp.send("");
        return xhttp.responseXML;
    }

    function displayResult() {
        var text_xml = {{ h.treeData_data_xml() }}
        var text_xsl = '<?xml version="1.0" encoding="UTF-8"?><xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"><xsl:template match="/child::*"><ul id="myUL"><xsl:for-each select="./child::*"><xsl:call-template name="subchild"/></xsl:for-each></ul></xsl:template><xsl:template name="subchild"><li><xsl:choose><xsl:when test="./child::*"><div class="caret"><xsl:value-of select="name(.)" /><a href="?level{./@level}={name(.)}"><span class="badge"><xsl:value-of select="./@count" /></span></a></div></xsl:when><xsl:otherwise><div class="caret-down"><xsl:value-of select="name(.)" /><a href="?level{./@level}={name(.)}"><span class="badge"><xsl:value-of select="./@count" /></span></a></div></xsl:otherwise></xsl:choose><ul class="nested"><xsl:for-each select="./child::*"><xsl:choose><xsl:when test="./child::*"><xsl:call-template name="subchild"/></xsl:when><xsl:otherwise><li><div class="caret-down"><xsl:value-of select="name(.)" /><a href="?level{./@level}={name(.)}"><span class="badge"><xsl:value-of select="./@count" /></span></a></div></li></xsl:otherwise></xsl:choose></xsl:for-each></ul></li></xsl:template></xsl:stylesheet>';

        parser = new DOMParser();
        xml = parser.parseFromString(text_xml,"text/xml");
        xsl = parser.parseFromString(text_xsl,"text/xml");
        // xml = loadXMLDoc();
        // xsl = loadXMLDoc("filename.xsl");
        // code for IE
        if (window.ActiveXObject || xhttp.responseType == "msxml-document") {
            ex = xml.transformNode(xsl);
            document.getElementById("example").innerHTML = ex;
        }
        // code for Chrome, Firefox, Opera, etc.
        else if (document.implementation && document.implementation.createDocument) {
            xsltProcessor = new XSLTProcessor();
            xsltProcessor.importStylesheet(xsl);
            resultDocument = xsltProcessor.transformToFragment(xml, document);
            document.getElementById("example").appendChild(resultDocument);
        }
    }
</script>
<style>
    ul,
    #myUL {
        list-style-type: none;
    }

    #myUL {
        margin: 0;
        padding: 0;
    }

    .caret {
        user-select: true;
    }

    .badge {
        cursor: pointer;
        margin-left: 10px;
        display: inline-block;
        padding: 5px 5px;
        font-size: auto;
        line-height: 1;
        color: #144690;
        text-align: center
    }

    /* Create the caret/arrow with a unicode, and style it */
    .caret::before {
        content: "\25CF";
        color: #50A723;
        display: inline-block;
        margin-right: 6px;
    }

    /* Rotate the caret/arrow icon when clicked on (using JavaScript) */
    .caret-down::before {
        content: "\25CB";
        color: #50A723;
        display: inline-block;
        margin-right: 6px;
    }

    /* Hide the nested list */
    .nested {
        cursor: pointer;
        display: none;
    }

    /* Show the nested list when the user clicks on the caret/arrow (with JavaScript) */
    .active {
        display: block;
    }
</style>